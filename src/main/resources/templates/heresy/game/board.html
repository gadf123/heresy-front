<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/config :: configFragment">
</head>
<body>
<div th:replace="layout/header :: header"></div>
<div class="content">
    <div class="container">
        <div style="height:700px">
            <div style="padding-top: 50px; height: 600px;">
                <table class="table">
                    <thead>
                        <tr id="tableHead">
                            <th scope="col" id="articleIdx">No</th>
                            <th scope="col" id="title">Title</th>
                            <th scope="col" id="userNickName">Author</th>
                            <th scope="col" id="good">Like</th>
                            <th scope="col" id="bad">DisLike</th>
                            <th scope="col" id="createDate">Date</th>
                        </tr>
                    </thead>
                    <tbody id="tableContent">
                    </tbody>
                </table>
            </div>
            <div class="paging" style="height: 50px;">
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center" id="pagination">
                    </ul>
                </nav>
            </div>
            <div style="float: right; height: 50px;">
                <button type="button" class="btn btn-dark" id="boardWriteBtn"
                        onclick="location.href = '/heresy/game/write'">
                    글쓰기
                </button>
            </div>
        </div>
    </div>
</div>
</body>
<script th:inline="javascript">



</script>
<script th:inline="javascript">
    $(document).ready(function(){

        var url = new URL(window.location.href);
        var currentPage = url.searchParams.get("page");

        var pageView = function(user){
          if(user){
              $('#boardWriteBtn').css('display','block');
          }else{
              $('#boardWriteBtn').css('display','none');
          }
        };

        var makeTableRow = function(rowItem){

            var rows = rowItem.map(function (item, index) {
                var row = document.createElement('tr');
                row.setAttribute('class','list_link_to');
                row.setAttribute('id',item.articleIdx);
                $('#tableHead').children().toArray().forEach(function(columnName, index){
                    var column = null;
                    if(index ===0){
                        column = document.createElement('th');
                    }else{
                        column = document.createElement('td');
                    }
                    column.setAttribute('id', columnName+''+item.articleIdx);
                    column.appendChild(document.createTextNode(
                        columnName.id === 'createDate' ? parseTime(item[columnName.id]) : item[columnName.id])
                    );
                    row.appendChild(column)
                });
                return row;
            });

            return rows;
        };

        var drawTable = function(){
            ajaxCall(
                '/board/getAllArticle'
                , {
                    data : {
                        pageSize : 10,
                        currentPage : currentPage
                    }
                }
                , function (data, jqXHR) {

                    if($('#tableContent').children()){
                        $('#tableContent').empty();
                    }

                    var rows = makeTableRow(data.contentList);
                    rows.map(function (row) {
                        $('#tableContent').append(row);
                    });

                    var pagination = makePagination(data.pagination, currentPage);
                    $('#pagination').append(pagination);

                    var linkTo = function(event){
                        location.href = "/heresy/game/view?id=" + $(this).attr('id');
                    };
                    $('.list_link_to').click(linkTo)
                }
                , function (jqXHR) {
                    console.log(jqXHR);
                    alert("server error")
                }
            );
        };

        userModule.init(pageView).then(function(user){
            console.log(user);
            drawTable();
        });
    });
</script>
</html>